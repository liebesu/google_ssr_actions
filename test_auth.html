<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤è¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0f172a; color: #e5e7eb; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #1f2937; border-radius: 8px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .info { background: #3b82f6; color: white; }
        input, button { padding: 8px; margin: 5px; border-radius: 4px; border: 1px solid #1f2937; background: #0b1220; color: #e5e7eb; }
        button { cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” è®¤è¯æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h3>å½“å‰è®¤è¯ä¿¡æ¯</h3>
        <div id="current-auth" class="result info"></div>
    </div>
    
    <div class="test-section">
        <h3>å¯†ç æµ‹è¯•</h3>
        <input type="text" id="test-password" placeholder="è¾“å…¥å¯†ç æµ‹è¯•" />
        <button onclick="testPassword()">æµ‹è¯•å¯†ç </button>
        <div id="password-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>è®¤è¯æµç¨‹æµ‹è¯•</h3>
        <input type="text" id="test-user" placeholder="ç”¨æˆ·å" />
        <input type="password" id="test-pass" placeholder="å¯†ç " />
        <button onclick="testAuth()">æµ‹è¯•è®¤è¯</button>
        <div id="auth-result" class="result"></div>
    </div>

    <script>
        // ä½¿ç”¨å®é™…çš„è®¤è¯ä¿¡æ¯
        const AUTH_HASH = "37092303178fc51f57a52ea39e166a4954ec86c075de3a9df7a221c9ef7e0891";
        const AUTH_USER = "liebesu";
        
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        function updateCurrentAuth() {
            document.getElementById('current-auth').innerHTML = `
                <strong>AUTH_HASH:</strong> ${AUTH_HASH}<br>
                <strong>AUTH_USER:</strong> ${AUTH_USER}<br>
                <strong>å­˜å‚¨çš„è®¤è¯:</strong> ${localStorage.getItem('gauth') || 'æ— '}<br>
                <strong>å­˜å‚¨çš„ç”¨æˆ·:</strong> ${localStorage.getItem('guser') || 'æ— '}
            `;
        }
        
        async function testPassword() {
            const password = document.getElementById('test-password').value;
            if (!password) {
                document.getElementById('password-result').innerHTML = '<div class="error">è¯·è¾“å…¥å¯†ç </div>';
                return;
            }
            
            const hash = await sha256(password);
            const match = hash.toLowerCase() === AUTH_HASH.toLowerCase();
            
            document.getElementById('password-result').innerHTML = `
                <div class="${match ? 'success' : 'error'}">
                    ${match ? 'âœ… å¯†ç æ­£ç¡®!' : 'âŒ å¯†ç é”™è¯¯'}<br>
                    <strong>è¾“å…¥å¯†ç :</strong> ${password}<br>
                    <strong>è®¡ç®—å“ˆå¸Œ:</strong> ${hash}<br>
                    <strong>ç›®æ ‡å“ˆå¸Œ:</strong> ${AUTH_HASH}
                </div>
            `;
        }
        
        async function testAuth() {
            const user = document.getElementById('test-user').value;
            const pass = document.getElementById('test-pass').value;
            
            if (!user || !pass) {
                document.getElementById('auth-result').innerHTML = '<div class="error">è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç </div>';
                return;
            }
            
            const hash = await sha256(pass);
            const userOk = user === AUTH_USER;
            const passOk = hash.toLowerCase() === AUTH_HASH.toLowerCase();
            const authOk = userOk && passOk;
            
            document.getElementById('auth-result').innerHTML = `
                <div class="${authOk ? 'success' : 'error'}">
                    ${authOk ? 'âœ… è®¤è¯æˆåŠŸ!' : 'âŒ è®¤è¯å¤±è´¥'}<br>
                    <strong>ç”¨æˆ·åéªŒè¯:</strong> ${userOk ? 'âœ…' : 'âŒ'} (${user} vs ${AUTH_USER})<br>
                    <strong>å¯†ç éªŒè¯:</strong> ${passOk ? 'âœ…' : 'âŒ'}<br>
                    <strong>è®¡ç®—å“ˆå¸Œ:</strong> ${hash}
                </div>
            `;
            
            if (authOk) {
                try {
                    localStorage.setItem('gauth', hash);
                    localStorage.setItem('guser', user);
                    updateCurrentAuth();
                } catch(e) {
                    console.error('ä¿å­˜è®¤è¯ä¿¡æ¯å¤±è´¥:', e);
                }
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ›´æ–°æ˜¾ç¤º
        updateCurrentAuth();
    </script>
</body>
</html>
